<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Poker All-in By Phoneix E </title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
<script>
  function hideAlert() {
    document.getElementById("alertBox").style.display = "none";
  }
</script>
   <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    h2 { color: #333; }
    .card-grid { display: flex; flex-wrap: wrap; gap: 4px; max-width: 420px; }
    .card-option {
      padding: 6px 8px;
      border: 1px solid #aaa;
      cursor: pointer;
      border-radius: 4px;
      background: #fff;
      user-select: none;
    }
    .selected {
      background: #4caf50;
      color: #fff;
    }
    .red { color: red; }
    #game, #result { margin-top: 15px; font-weight: bold; white-space: pre-line; }
    #alertBox {
      display: none;
      position: fixed;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #ff4444;
      color: white;
      font-size: 32px;
      font-weight: bold;
      padding: 30px 50px;
      border-radius: 10px;
      text-align: center;
      animation: blink 1s infinite;
      z-index: 9999;
    }
    @keyframes blink {
      0%, 50%, 100% { opacity: 1; }
      25%, 75% { opacity: 0.2; }
    }
  </style>
</head>
<body>
  <h2>üÉè Poker All-in By Phoneix E</h2>

  <div id="login">
    <label>Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i (A, B ho·∫∑c C):</label>
    <input id="playerId" maxlength="1" placeholder="A">
    <button onclick="login()">B·∫Øt ƒë·∫ßu</button>
  </div>

  <div id="game" style="display:none">
    <h3 id="playerLabel"></h3>
    <p>Ch·ªçn b√†i c·ªßa b·∫°n (ch·ªçn ƒë√∫ng 2 l√°):</p>
    <div id="cardGrid" class="card-grid"></div>
    <button onclick="submitCard()">ƒê·ªÉ l∆∞u b√†i</button>
  </div>

  <div id="result"></div>
  <div id="alertBox">
  <div id="alertContent">üî¥ T·∫§T C·∫¢ NG∆Ø·ªúI CH∆†I H√ÉY CHU·∫®N B·ªä ALL-IN!</div>
  <button onclick="hideAlert()" style="margin-top: 20px; padding: 8px 16px; font-size: 18px; cursor: pointer;">T·∫Øt th√¥ng b√°o</button>
</div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBDXpq31YRr478Xezv-Q-V09tHfJbJPNzs",
      authDomain: "poker-allin.firebaseapp.com",
      databaseURL: "https://poker-allin-default-rtdb.firebaseio.com",
      projectId: "poker-allin",
      storageBucket: "poker-allin.firebasestorage.app",
      messagingSenderId: "994085326808",
      appId: "1:994085326808:web:2a5f0268e41d62521facad",
      measurementId: "G-Q0817MG396"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const suits = ['s', 'h', 'd', 'c'];
    const suitNames = {'s':'‚ô†', 'h':'‚ô•', 'd':'‚ô¶', 'c':'‚ô£'};
    const redSuits = ['h', 'd'];
    const ranks = ['2','3','4','5','6','7','8','9','T','J','Q','K','A'];
    const rankValue = {'2': 2,'3': 3,'4': 4,'5': 5,'6': 6,'7': 7,'8': 8,'9': 9,'T': 10,'J': 11,'Q': 12,'K': 13,'A': 14};
    const rankName = {2:'ƒê√¥i 2', 3:'ƒê√¥i 3', 4:'ƒê√¥i 4', 5:'ƒê√¥i 5', 6:'ƒê√¥i 6', 7:'ƒê√¥i 7', 8:'ƒê√¥i 8', 9:'ƒê√¥i 9', 10:'ƒê√¥i 10', 11:'ƒê√¥i J', 12:'ƒê√¥i Q', 13:'ƒê√¥i K', 14:'ƒê√¥i A'};

    let currentPlayer = null;
    let selectedCards = [];
    let resetTimer = null;

    function login() {
      const id = document.getElementById("playerId").value.toUpperCase();
      if (!['A','B','C'].includes(id)) {
        alert("Ch·ªâ ch·∫•p nh·∫≠n A, B ho·∫∑c C");
        return;
      }
      currentPlayer = id;
      document.getElementById("login").style.display = "none";
      document.getElementById("game").style.display = "block";
      document.getElementById("playerLabel").innerText = `B·∫°n l√† ng∆∞·ªùi ch∆°i: ${id}`;
      renderCardOptions();
      listenForUpdates();
    }

    function renderCardOptions() {
      const grid = document.getElementById("cardGrid");
      grid.innerHTML = '';
      ranks.forEach(r => {
        suits.forEach(s => {
          const code = r + s;
          const div = document.createElement("div");
          div.innerText = r + suitNames[s];
          div.className = "card-option";
          if (redSuits.includes(s)) div.classList.add("red");
          div.dataset.code = code;
          div.onclick = () => toggleCard(div, r, s);
          grid.appendChild(div);
        });
      });
    }

    function toggleCard(el, r, s) {
      const code = r + s;
      if (el.classList.contains("selected")) {
        el.classList.remove("selected");
        selectedCards = selectedCards.filter(c => c.code !== code);
      } else {
        if (selectedCards.length >= 2) {
          alert("Ch·ªâ ƒë∆∞·ª£c ch·ªçn 2 l√° b√†i");
          return;
        }
        el.classList.add("selected");
        selectedCards.push({ rank: rankValue[r], suit: s, code });
      }
    }

    function handStrength(c1, c2) {
      const r1 = c1.rank, r2 = c2.rank;
      const suited = c1.suit === c2.suit;
      const high = Math.max(r1, r2);
      if (r1 === r2) return 100 + r1;
      if (suited && Math.abs(r1 - r2) === 1) return 85 + high;
      if (suited) return 70 + high;
      if (Math.abs(r1 - r2) === 1) return 60 + high;
      return high;
    }

    function getPairName(c1, c2) {
      if (c1.rank === c2.rank) return rankName[c1.rank];
      return "Kh√¥ng ƒë√¥i";
    }

    function submitCard() {
      if (selectedCards.length !== 2) {
        alert("B·∫°n c·∫ßn ch·ªçn ƒë√∫ng 2 l√° b√†i");
        return;
      }
      firebase.database().ref("cards/" + currentPlayer).set(selectedCards);
      alert("‚úÖ ƒê√£ l∆∞u b√†i. Ch·ªù c√°c ng∆∞·ªùi ch∆°i kh√°c...");
    }

    function resetAfterDelay() {
  if (resetTimer) clearTimeout(resetTimer);
  resetTimer = setTimeout(() => {
    firebase.database().ref("cards").remove();
    document.getElementById("result").innerText = "üßπ B√†i ƒë√£ ƒë∆∞·ª£c reset. M·ªùi ch∆°i v√°n m·ªõi.";
    document.getElementById("alertBox").style.display = "none";
  }, 20000);
}
    
    function simulatePairRate(cards) {
  const fullDeck = [];
  ranks.forEach(r => {
    suits.forEach(s => {
      fullDeck.push({ rank: rankValue[r], suit: s, code: r + s });
    });
  });

  const usedCards = Object.values(cards).flat();
  const usedCodes = new Set(usedCards.map(c => c.code));
  const remainingDeck = fullDeck.filter(c => !usedCodes.has(c.code));

  const simulations = 1000;
  const pairCounts = { A: 0, B: 0, C: 0 };

  for (let i = 0; i < simulations; i++) {
    // R√∫t 5 l√° t·ª´ b·ªô b√†i c√≤n l·∫°i
    const tempDeck = [...remainingDeck];
    const board = [];
    for (let j = 0; j < 5; j++) {
      const idx = Math.floor(Math.random() * tempDeck.length);
      board.push(tempDeck.splice(idx, 1)[0]);
    }

    ['A', 'B', 'C'].forEach(p => {
      const hand = [...cards[p], ...board];
      const seen = new Set();
      let hasPair = false;

      for (let k = 0; k < hand.length; k++) {
        for (let l = k + 1; l < hand.length; l++) {
          const r1 = hand[k].rank;
          const r2 = hand[l].rank;
          if (r1 === r2 && !seen.has(r1)) {
            hasPair = true;
            seen.add(r1);
            break;
          }
        }
        if (hasPair) break;
      }

      if (hasPair) pairCounts[p]++;
    });
  }

  const rates = {};
  ['A', 'B', 'C'].forEach(p => {
    rates[p] = (pairCounts[p] / simulations * 100).toFixed(1) + '%';
  });
  return rates;
  }
function listenForUpdates() {
      firebase.database().ref("cards").on("value", snapshot => {
        const cards = snapshot.val();
        if (!cards) return;
        const players = Object.keys(cards);
        if (players.length === 3) {
          const allCards = Object.values(cards).flat();
          const used = new Set(allCards.map(c => c.code));
          if (used.size < 6) {
            document.getElementById("result").innerText = "‚ö†Ô∏è C√≥ l√° b√†i tr√πng nhau.";
            return;
          }
          const scores = [
            {player: 'A', score: handStrength(...cards['A'])},
            {player: 'B', score: handStrength(...cards['B'])},
            {player: 'C', score: handStrength(...cards['C'])}
          ];
          scores.sort((a,b) => b.score - a.score);
          const pairRates = simulatePairRate(cards);
          const best = scores[0];

          const details = scores.map(s => {
            const [c1, c2] = cards[s.player];
            const pairName = getPairName(c1, c2);
            return `Player ${s.player}: ${pairName} ‚Äì ƒêi·ªÉm: ${s.score} ‚Äì T·ª∑ l·ªá c√≥ ƒë√¥i (7 l√°): ${pairRates[s.player]}`;
          });

          // details.push(`
‚úÖ Ng∆∞·ªùi n√™n all-in: Player ${best.player} (ƒêi·ªÉm: ${best.score})`);
          document.getElementById("result").innerText = details.join("

");

          let alertText = details.map(line => `<div style='font-size:20px;'>${line}</div>`).join('');
            document.getElementById("alertContent").innerHTML = `üî¥ T·∫§T C·∫¢ NG∆Ø·ªúI CH∆†I H√ÉY CHU·∫®N B·ªä ALL-IN!<hr style='margin:10px 0;'>${alertText}`;
            document.getElementById("alertBox").style.display = "block";
          resetAfterDelay();
        } else {
          document.getElementById("result").innerText = "‚åõ ƒê·ª£i c√°c ng∆∞·ªùi ch∆°i kh√°c nh·∫≠p b√†i...";
          document.getElementById("alertBox").style.display = "none";
        }
      });
    }
  </script>
</body>
</html>
