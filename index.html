<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Poker All-in By Phoneix</title>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    h2 { color: #333; }
    .card-grid { display: flex; flex-wrap: wrap; gap: 4px; max-width: 420px; }
    .card-option {
      padding: 6px 8px;
      border: 1px solid #aaa;
      cursor: pointer;
      border-radius: 4px;
      background: #fff;
      user-select: none;
    }
    .selected {
      background: #4caf50;
      color: #fff;
    }
    .red { color: red; }
    #game, #result { margin-top: 15px; font-weight: bold; }
    #alertBox {
      display: none;
      position: fixed;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #ff4444;
      color: white;
      font-size: 32px;
      font-weight: bold;
      padding: 30px 50px;
      border-radius: 10px;
      text-align: center;
      animation: blink 1s infinite;
      z-index: 9999;
    }
    @keyframes blink {
      0%, 50%, 100% { opacity: 1; }
      25%, 75% { opacity: 0.2; }
    }
  </style>
</head>
<body>
  <h2>üÉè Poker All-in By Phoneix</h2>

  <div id="login">
    <label>Nh·∫≠p t√™n ng∆∞·ªùi ch∆°i (A, B ho·∫∑c C):</label>
    <input id="playerId" maxlength="1" placeholder="A">
    <button onclick="login()">B·∫Øt ƒë·∫ßu</button>
  </div>

  <div id="game" style="display:none">
    <h3 id="playerLabel"></h3>
    <p>Ch·ªçn b√†i c·ªßa b·∫°n (ch·ªçn ƒë√∫ng 2 l√°):</p>
    <div id="cardGrid" class="card-grid"></div>
    <button onclick="submitCard()">L∆∞u b√†i</button>
  </div>

  <div id="result"></div>
  <div id="alertBox">B·∫†N ALL IN NGAY!</div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBDXpq31YRr478Xezv-Q-V09tHfJbJPNzs",
      authDomain: "poker-allin.firebaseapp.com",
      databaseURL: "https://poker-allin-default-rtdb.firebaseio.com",
      projectId: "poker-allin",
      storageBucket: "poker-allin.firebasestorage.app",
      messagingSenderId: "994085326808",
      appId: "1:994085326808:web:2a5f0268e41d62521facad",
      measurementId: "G-Q0817MG396"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const suits = ['s', 'h', 'd', 'c'];
    const suitNames = {'s':'‚ô†', 'h':'‚ô•', 'd':'‚ô¶', 'c':'‚ô£'};
    const redSuits = ['h', 'd'];
    const ranks = ['2','3','4','5','6','7','8','9','T','J','Q','K','A'];
    const rankValue = {'2': 2,'3': 3,'4': 4,'5': 5,'6': 6,'7': 7,'8': 8,'9': 9,'T': 10,'J': 11,'Q': 12,'K': 13,'A': 14};

    let currentPlayer = null;
    let selectedCards = [];
    let resetTimer = null;

    function login() {
      const id = document.getElementById("playerId").value.toUpperCase();
      if (!['A','B','C'].includes(id)) {
        alert("Ch·ªâ ch·∫•p nh·∫≠n A, B ho·∫∑c C");
        return;
      }
      currentPlayer = id;
      document.getElementById("login").style.display = "none";
      document.getElementById("game").style.display = "block";
      document.getElementById("playerLabel").innerText = `B·∫°n l√† ng∆∞·ªùi ch∆°i: ${id}`;
      renderCardOptions();
      listenForUpdates();
    }

    function renderCardOptions() {
      const grid = document.getElementById("cardGrid");
      grid.innerHTML = '';
      ranks.forEach(r => {
        suits.forEach(s => {
          const code = r + s;
          const div = document.createElement("div");
          div.innerText = r + suitNames[s];
          div.className = "card-option";
          if (redSuits.includes(s)) div.classList.add("red");
          div.dataset.code = code;
          div.onclick = () => toggleCard(div, r, s);
          grid.appendChild(div);
        });
      });
    }

    function toggleCard(el, r, s) {
      const code = r + s;
      if (el.classList.contains("selected")) {
        el.classList.remove("selected");
        selectedCards = selectedCards.filter(c => c.code !== code);
      } else {
        if (selectedCards.length >= 2) {
          alert("Ch·ªâ ƒë∆∞·ª£c ch·ªçn 2 l√° b√†i");
          return;
        }
        el.classList.add("selected");
        selectedCards.push({ rank: rankValue[r], suit: s, code });
      }
    }

    function handStrength(c1, c2) {
      const r1 = c1.rank, r2 = c2.rank;
      const suited = c1.suit === c2.suit;
      const high = Math.max(r1, r2);
      if (r1 === r2) return 100 + r1;
      if (suited && Math.abs(r1 - r2) === 1) return 85 + high;
      if (suited) return 70 + high;
      if (Math.abs(r1 - r2) === 1) return 60 + high;
      return high;
    }

    function submitCard() {
      if (selectedCards.length !== 2) {
        alert("B·∫°n c·∫ßn ch·ªçn ƒë√∫ng 2 l√° b√†i");
        return;
      }
      firebase.database().ref("cards/" + currentPlayer).set(selectedCards);
      alert("‚úÖ ƒê√£ l∆∞u b√†i. Ch·ªù c√°c ng∆∞·ªùi ch∆°i kh√°c...");
    }

    function resetAfterDelay() {
      if (resetTimer) clearTimeout(resetTimer);
      resetTimer = setTimeout(() => {
        firebase.database().ref("cards").remove();
        document.getElementById("result").innerText = "üßπ B√†i ƒë√£ ƒë∆∞·ª£c reset. M·ªùi ch∆°i v√°n m·ªõi.";
        document.getElementById("alertBox").style.display = "none";
      }, 20000);
    }

    function listenForUpdates() {
      firebase.database().ref("cards").on("value", snapshot => {
        const cards = snapshot.val();
        if (!cards) return;
        const players = Object.keys(cards);
        if (players.length === 3) {
          const allCards = Object.values(cards).flat();
          const used = new Set(allCards.map(c => c.code));
          if (used.size < 6) {
            document.getElementById("result").innerText = "‚ö†Ô∏è C√≥ l√° b√†i tr√πng nhau.";
            return;
          }
          const scores = [
            {player: 'A', score: handStrength(...cards['A'])},
            {player: 'B', score: handStrength(...cards['B'])},
            {player: 'C', score: handStrength(...cards['C'])}
          ];
          scores.sort((a,b) => b.score - a.score);
          const best = scores[0];
          document.getElementById("result").innerText = `‚úÖ Ng∆∞·ªùi n√™n all-in: Player ${best.player} (ƒêi·ªÉm: ${best.score})`;
          if (best.player === currentPlayer) {
            document.getElementById("alertBox").style.display = "block";
          }
          resetAfterDelay();
        } else {
          document.getElementById("result").innerText = "‚åõ ƒê·ª£i c√°c ng∆∞·ªùi ch∆°i kh√°c nh·∫≠p b√†i...";
          document.getElementById("alertBox").style.display = "none";
        }
      });
    }
  </script>
</body>
</html>
